<html>

<head>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Kernotec Firmas</title>
    <style>
        .cuadro {
            width: 600px;
            border: 1px solid #f3e4e4
        }
    </style>
</head>

<body>
    
    <object id="canvas_obj" class="svgClass cuadro" type="image/svg+xml" data="ic_device.svg"></object>
    <div id="divIcons"></div>
</body>
<script >
    let v = null;
    let names = [
    `ic_device_l0_e0_c0_b0`,
    `ic_device_l0_e0_c0_b1`,
    `ic_device_l0_e0_c0_b2`,
    `ic_device_l0_e0_c0_b3`,
    `ic_device_l0_e0_c1_b0`,
    `ic_device_l0_e0_c1_b1`,
    `ic_device_l0_e0_c1_b2`,
    `ic_device_l0_e0_c1_b3`,
    `ic_device_l0_e1_c0_b0`,
    `ic_device_l0_e1_c0_b1`,
    `ic_device_l0_e1_c0_b2`,
    `ic_device_l0_e1_c0_b3`,
    `ic_device_l0_e1_c1_b0`,
    `ic_device_l0_e1_c1_b1`,
    `ic_device_l0_e1_c1_b2`,
    `ic_device_l0_e1_c1_b3`,
    `ic_device_l1_e0_c0_b0`,
    `ic_device_l1_e0_c0_b1`,
    `ic_device_l1_e0_c0_b2`,
    `ic_device_l1_e0_c0_b3`,
    `ic_device_l1_e0_c1_b0`,
    `ic_device_l1_e0_c1_b1`,
    `ic_device_l1_e0_c1_b2`,
    `ic_device_l1_e0_c1_b3`,
    `ic_device_l1_e1_c0_b0`,
    `ic_device_l1_e1_c0_b1`,
    `ic_device_l1_e1_c0_b2`,
    `ic_device_l1_e1_c0_b3`,
    `ic_device_l1_e1_c1_b0`,
    `ic_device_l1_e1_c1_b1`,
    `ic_device_l1_e1_c1_b2`,
    `ic_device_l1_e1_c1_b3`,
        ];
    $( document ).ready(function() {
        
        names.forEach(n => {
                $("#divIcons").append(`<object id="${n}" class="svgClass cuadro" type="image/svg+xml" data="ic_device.svg"></object>`);
               
            });

        setTimeout(()=>{
            names.forEach(n => {
               // $("#divIcons").append(`<object id="${n}" class="svgClass cuadro" type="image/svg+xml" data="ic_device.svg"></object>`);               
                if (n.includes("l0")){                    
                    document.querySelector("#"+n).getSVGDocument().querySelector("#path9-1").style.fillOpacity = "0";   //ok
                }
                if (n.includes("e0")){                    
                    document.querySelector("#"+n).getSVGDocument().querySelector("#path10-4-1-3").style.fillOpacity = "0";
                }
                if (n.includes("c0")){                    
                    document.querySelector("#"+n).getSVGDocument().querySelector("#path4-4-3-8-1-3-7-0-7-2-5-8").style.fill = "rgb(255,255,255)";
                }
                if (n.includes("b0")){                    
                    document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-8-5-9-1-0-3-8-5-2-3").style.fill = "rgb(255,255,255)";
                    document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-3-4-4-1-4-7-6-6-4-3-2").style.fill = "rgb(255,255,255)";
                    document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-3-1-2-1-4-0-7-2-8-1-6-0").style.fill = "rgb(255,255,255)";
                }
                if (n.includes("b1")){                    
                    document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-3-4-4-1-4-7-6-6-4-3-2").style.fill = "rgb(255,255,255)";
                    document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-3-1-2-1-4-0-7-2-8-1-6-0").style.fill = "rgb(255,255,255)";
                }
                if (n.includes("b2")){                    
                    document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-3-1-2-1-4-0-7-2-8-1-6-0").style.fill = "rgb(255,255,255)";
                }
                if (n.includes("b3")){                    
                }
                
                    //document.querySelector("#"+n).getSVGDocument().querySelector("#rect5-8-5-9-1-0-3-8-5-2-3").style.fill = "rgb(255,255,255)";
            });

            //console.log(document.querySelector("#"+names[0]).outerHTML);

                    
            names.forEach((n,i) => {
                setTimeout(() => {
                        
                    var svg = document.getElementById(n).getSVGDocument();
                    var serializer = new XMLSerializer();
                    var source = serializer.serializeToString(svg);
                    source = source.replace(/(\w+)?:?xlink=/g, 'xmlns:xlink='); // Fix root xlink without namespace

                    source = source.replace(/ns\d+:href/g, 'xlink:href'); // Safari NS namespace fix.


                    if (!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)) {
                        source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
                    }
                    if (!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)) {
                        source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
                    }

                    var preface = '';
                    var svgBlob = new Blob([preface, source], { type: "image/svg+xml;charset=utf-8" });
                    var svgUrl = URL.createObjectURL(svgBlob);
                    var downloadLink = document.createElement("a");
                    downloadLink.href = svgUrl;
                    downloadLink.download = n;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                }, 1000+1000*i);
            });

            //let d = document.querySelector("#canvas_obj").contentDocument;
            //console.log(d.innerText);
            //d.getSVGDocument().querySelect("#rect4-1-3-1-1-9-6-7-4-7-1").style.fill="#ffffff";
            //document.querySelector(".svgClass").getSVGDocument().querySelector("#rect5-8-5-9-1-0-3-8-5-2-3").style ="fill:#ffffff;fill-opacity:1;stroke:#2c3bac;stroke-width:0.320991;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1";
            //d.querySelector("#rect5-8-5-9-1-0-3-8-5-2-3").style.fill = "rgb(255,255,255)";
            
            //console.log(document.querySelector(".svgClass").getSVGDocument().querySelector("#rect5-8-5-9-1-0-3-8-5-2-3").style.fill);
            
            //let svgObj = $(`<object id="canvas_obj" class="svgClass2 cuadro" type="image/svg+xml" ></object>`);
            //let svgObj = $(d);
            //svgObj.attr("data",d);
            //$("#divIcons").append(d);
        },2000);
        
    });

    function actualizarDatos() {
        document.querySelector(".svgClass").getSVGDocument().querySelector(".cls-18").innerHTML = $("#inputNombre").val();
        document.querySelector(".svgClass").getSVGDocument().querySelector(".cls-19").innerHTML = $("#inputCargo").val();
        document.querySelector(".svgClass").getSVGDocument().querySelector(".cls-20").innerHTML = $("#inputCorreo").val();
        document.querySelector(".svgClass").getSVGDocument().querySelector(".cls-numero").innerHTML = $("#inputNumero").val();
        document.querySelector(".svgClass").getSVGDocument().querySelector(".cls-22").innerHTML = $("#inputCorto").val();

        document.querySelector(".svgClass2").getSVGDocument().querySelector(".cls-17").innerHTML = $("#inputNombre").val();
        document.querySelector(".svgClass2").getSVGDocument().querySelector(".cls-18").innerHTML = $("#inputCargo").val();
        document.querySelector(".svgClass2").getSVGDocument().querySelector(".cls-19").innerHTML = $("#inputCorreo").val();
        document.querySelector(".svgClass2").getSVGDocument().querySelector(".cls-numero").innerHTML = $("#inputNumero").val();
        document.querySelector(".svgClass2").getSVGDocument().querySelector(".cls-21").innerHTML = $("#inputCorto").val();


        document.querySelector(".svgClass3").getSVGDocument().querySelector(".cls-16").innerHTML = $("#inputNombre").val();
        document.querySelector(".svgClass3").getSVGDocument().querySelector(".cls-17").innerHTML = $("#inputCargo").val();
        document.querySelector(".svgClass3").getSVGDocument().querySelector(".cls-18").innerHTML = $("#inputCorreo").val();
        document.querySelector(".svgClass3").getSVGDocument().querySelector(".cls-numero").innerHTML = $("#inputNumero").val();
        document.querySelector(".svgClass3").getSVGDocument().querySelector(".cls-20").innerHTML = $("#inputCorto").val();

        document.querySelector(".svgClass4").getSVGDocument().querySelector(".cls-18").innerHTML = $("#inputNombre").val();
        document.querySelector(".svgClass4").getSVGDocument().querySelector(".cls-19").innerHTML = $("#inputCargo").val();
        document.querySelector(".svgClass4").getSVGDocument().querySelector(".cls-20").innerHTML = $("#inputCorreo").val();
        document.querySelector(".svgClass4").getSVGDocument().querySelector(".cls-numero").innerHTML = $("#inputNumero").val();
        document.querySelector(".svgClass4").getSVGDocument().querySelector(".cls-22").innerHTML = $("#inputCorto").val();

        document.querySelector(".svgClass5").getSVGDocument().querySelector(".cls-17").innerHTML = $("#inputNombre").val();
        document.querySelector(".svgClass5").getSVGDocument().querySelector(".cls-18").innerHTML = $("#inputCargo").val();
        document.querySelector(".svgClass5").getSVGDocument().querySelector(".cls-21").innerHTML = $("#inputCorreo").val();
        document.querySelector(".svgClass5").getSVGDocument().querySelector(".cls-numero").innerHTML = $("#inputNumero").val();
        document.querySelector(".svgClass5").getSVGDocument().querySelector(".cls-19").innerHTML = $("#inputCorto").val();


    };
    function actualizarDatos2(el, tag) {
        console.log(el);
        document.querySelector(".svgClass").getSVGDocument().querySelector(tag).innerHTML = el.value;

    };
    function descargar(aTag, imgTag) {

        const canvas = document.querySelector('canvas');
        canvas.width = 716.06;//653 ;
        canvas.height = 185.33; //143 ;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        v = Canvg.fromString(ctx, document.querySelector(imgTag).getSVGDocument().querySelector("svg").outerHTML);
        v.start();

        var img = canvas.toDataURL("img/jpeg");

        //window.location.href = 'data:application/octet-stream;base64,' + img;
        //var a = document.createElement("a"); //Create <a>
        var a = document.querySelector(aTag);
        a.href = img;
        a.download = $("#inputNombre").val().toLowerCase().replaceAll(' ', '_') + ".jpg";
        //a.click(); 
    }

    //document.querySelector(".svgClass").getSVGDocument().getElementById("svgInternalID").setAttribute("fill", "red")
    // $("#inputNombre").on('keyup',function (e) { actualizarDatos2(this,".cls-17"); });
    $("#inputNombre").keyup(function (e) { actualizarDatos(); });
    $("#inputCargo").keyup(function (e) { actualizarDatos(); });
    $("#inputCorreo").keyup(function (e) { actualizarDatos(); });
    $("#inputNumero").keyup(function (e) { actualizarDatos(); });
    $("#inputCorto").keyup(function (e) { actualizarDatos(); });
    $("#descargar1").click(function (e) { descargar("#descargar1", ".svgClass"); });
    $("#descargar2").click(function (e) { descargar("#descargar2", ".svgClass2"); });
    $("#descargar3").click(function (e) { descargar("#descargar3", ".svgClass3"); });
    $("#descargar4").click(function (e) { descargar("#descargar4", ".svgClass4"); });
    $("#descargar5").click(function (e) { descargar("#descargar5", ".svgClass5"); });

    $("#font1mas").click(function (e) { fontIncrease(".svgClass", ".cls-18", 24) });
    $("#font1menos").click(function (e) { fontDecrease(".svgClass", ".cls-18", 24) });

    $("#font1masC").click(function (e) { fontIncrease(".svgClass", ".cls-19", 15) });
    $("#font1menosC").click(function (e) { fontDecrease(".svgClass", ".cls-19", 15) });

    $("#font2mas").click(function (e) { fontIncrease(".svgClass2", ".cls-17") });
    $("#font2menos").click(function (e) { fontDecrease(".svgClass2", ".cls-17") });

    $("#font3mas").click(function (e) { fontIncrease(".svgClass3", ".cls-16") });
    $("#font3menos").click(function (e) { fontDecrease(".svgClass3", ".cls-16") });

    $("#font4mas").click(function (e) { fontIncrease(".svgClass4", ".cls-18") });
    $("#font4menos").click(function (e) { fontDecrease(".svgClass4", ".cls-18") });

    $("#font5mas").click(function (e) { fontIncrease(".svgClass5", ".cls-17") });
    $("#font5menos").click(function (e) { fontDecrease(".svgClass5", ".cls-17") });


    function fontIncrease(svg, cls, siz = 23) {
        if (document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize == "")
            document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize = siz;
        var f = document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize;
        console.log("f", f);
        var s = f.match(/[0-9]*/g);
        var fs = parseFloat(s[0]) + 1;
        document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize = fs;
    }
    function fontDecrease(svg, cls, siz = 23) {
        if (document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize == "")
            document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize = siz;
        var f = document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize;
        console.log("f", f);
        var s = f.match(/[0-9]*/g);
        var fs = parseFloat(s[0]) - 1;
        document.querySelector(svg).getSVGDocument().querySelector(cls).style.fontSize = fs;
    }

</script>

</html>